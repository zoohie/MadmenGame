const fs = require('fs');
const path = require('path');

const styles = require('./style');
const getHtml = require('./html');
const walk = require('../walk');
const PATH = require("../../constants");

(() => {
    const logoPath = path.join(PATH.data, 'logo');
    const htmlPath = path.join(PATH.data, 'index.html');
    const cssPath = path.join(PATH.data, 'style.css');
    const videoPath = path.join(__dirname, 'video');

    // copy files
    fs.mkdir(logoPath, { recursive: true }, (err) => {
        if (err) throw err;
        walk(videoPath, null, (err, video) => {
            if (err) throw err;
            video.forEach((file) => {
                fs.copyFile(file, path.join(logoPath, path.basename(file)), (err) => {
                    if (err) throw err;
                });
            });

            // insert styles and html
            fs.readFile(htmlPath, {encoding: 'utf-8'}, (err, html) => {
                if (err) throw err;
                let newHtml = html.replace('<body>', '<body>' + getHtml(video));

                fs.writeFile(htmlPath, newHtml, (err) => {
                    if (err) throw err;
                })
            });
            const newLineChar = process.platform === 'win32' ? '\r\n' : '\n';
            fs.appendFileSync(cssPath, `${newLineChar}${styles}`);
        })
    });
})();

