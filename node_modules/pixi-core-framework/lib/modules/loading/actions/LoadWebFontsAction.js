import * as FontFaceObserver from "fontfaceobserver";
import { BaseAction } from "../../../core/engine/fsm/BaseAction";
export class LoadWebFontsAction extends BaseAction {
    execute() {
        return new Promise((resolve) => {
            if (window.navigator.userAgent.indexOf("Edge") > -1) {
                resolve();
            }
            let sheet = document.styleSheets;
            const observers = [];
            for (let i = 0; i < sheet.length; i++) {
                let rule = sheet[i]["rules"] || sheet[i]["cssRules"];
                if (!rule) {
                    continue;
                }
                for (let j = 0; j < rule.length; j++) {
                    if (rule[j].constructor.name === 'CSSFontFaceRule') {
                        let fontFamily = (rule[j].style.cssText.match(/font-family: *([^;]+);/i))[1].toString().replace('"', '').replace('"', '');
                        let fontWeight = (rule[j].style.cssText.match(/font-weight: *([^;]+);/i) || ["", ""])[1].toString();
                        let fontStyle = (rule[j].style.cssText.match(/font-style: *([^;]+);/i) || ["", ""])[1].toString();
                        observers.push(new FontFaceObserver(fontFamily, {
                            weight: fontWeight,
                            style: fontStyle
                        }));
                    }
                }
            }
            if (observers.length > 0) {
                Promise.all(observers.map((observer) => {
                    console.log(observer);
                    return observer.load(null, 200000);
                })).then(() => {
                    resolve();
                });
            }
            else {
                resolve();
            }
        });
    }
}
//# sourceMappingURL=LoadWebFontsAction.js.map